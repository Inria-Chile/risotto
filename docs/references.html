---

title: Exploring CORD-19 references

keywords: fastai
sidebar: home_sidebar

summary: "This notebooks explores how much information we can obtain from the citation references of the papers in the COVID-19 Open Research Dataset Challenge (CORD-19)."
description: "This notebooks explores how much information we can obtain from the citation references of the papers in the COVID-19 Open Research Dataset Challenge (CORD-19)."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_references.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div align='left' style="width:29%;overflow:hidden;">
<a href='http://inria.fr'>
{% include image.html alt="Inria logo" title="Inria logo" file="https://github.com/lmarti/jupyter_custom/raw/master/imgs/inr_logo_rouge.png" %}
</a>
</div>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-the-CORD-19-dataset">Loading the CORD-19 dataset<a class="anchor-link" href="#Loading-the-CORD-19-dataset"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cord19_dataset_folder</span> <span class="o">=</span> <span class="s2">&quot;./datasets/CORD-19-research-challenge&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Good to go&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_root</span><span class="si">}</span><span class="s1"> does not exist! Download it using 00_download.ipynb.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Loading <code>metadata.csv</code> file as a pandas <code>DataFrame</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cord19_dataset_folder</span><span class="si">}</span><span class="s2">/metadata.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;cord_uid&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How metadata looks like?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">file_in_metadata_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sa">f</span><span class="s1">&#39;Total records loaded: </span><span class="si">{</span><span class="n">file_in_metadata_count</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metadata_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">metadata_df</span><span class="p">[</span><span class="s2">&quot;pdf_json_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s2">&quot;pmc_json_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each paper is represented by a unique id called <code>cord_uid</code>.</p>
<p>Meaning of columns:</p>
<ul>
<li><code>sha</code>: PDF file hash</li>
<li><code>source_x</code>: source repository, e.g. Biorxiv, Elsevier, etc.</li>
<li><code>title</code>: paper title</li>
<li><code>doi</code>, <code>pmcid</code>, <code>pubmed_id</code>, <code>Microsoft Academic Paper ID</code>, <code>WHO #Covidence</code>: other document ids</li>
<li><code>license</code>: usage license</li>
<li><code>abstract</code>:plain text abstract</li>
<li><code>publish_time</code>: publish date</li>
<li><code>journal</code>: academic journal of publication, if applicable</li>
<li><code>authors</code>: authors in plain text</li>
<li><code>has_pdf_parse</code>: if PDF parsing is available</li>
<li><code>has_pmc_xml_parse</code>: if PubMed XML is available</li>
<li><code>full_text_file</code>: pointer to the source file in the dataset</li>
<li><code>url</code>: URL to paper online source</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following cells will explore the folders and files structure of the dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">_sample_json_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">file_names</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">sample_file_name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">file_names</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sample_file_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">walk_dataset</span><span class="p">():</span>
    <span class="n">cum_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">folders</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">):</span>
        <span class="n">num_folders</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">folders</span><span class="p">)</span>
        <span class="n">num_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;json&quot;</span> <span class="ow">in</span> <span class="n">root</span> <span class="ow">and</span> <span class="n">num_folders</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num_files</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cum_sum</span> <span class="o">+=</span> <span class="n">num_files</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num_files</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cum_sum</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source_file_count</span> <span class="o">=</span> <span class="n">walk_dataset</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Files in metadata: </span><span class="si">{</span><span class="n">file_in_metadata_count</span><span class="si">}</span><span class="s1">, source files: </span><span class="si">{</span><span class="n">source_file_count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;We have </span><span class="si">{</span><span class="n">source_file_count</span><span class="o">-</span><span class="n">file_in_metadata_count</span><span class="si">}</span><span class="s1"> files without metadata.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>According to the information found in the Kaggle community site, there are at least two recommended procedures to load the dataset.</p>
<div class="highlight"><pre><span></span><span class="c1"># First method</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">metadata_file</span><span class="p">:</span>
    <span class="n">pmc_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;pmc_id&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">exists</span> <span class="n">pmc_id</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">pmc_jsons</span> <span class="n">subfolders</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pmc_id</span> <span class="n">file</span>
    <span class="c1"># If `pmc_id` is null or there is no file</span>
    <span class="n">sha</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sha&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">exists</span> <span class="n">sha</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">pdf_jsons</span> <span class="n">subfolders</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sha</span> <span class="n">file</span>

<span class="c1"># Second method</span>
<span class="k">for</span> <span class="n">pdf</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">pdf</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">pdf</span> <span class="n">file</span> <span class="n">sha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_file</span> <span class="n">shas</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">metadata_file</span> <span class="n">row</span> <span class="k">with</span> <span class="n">matching</span> <span class="n">pdf</span> <span class="n">file</span> <span class="n">sha</span>
        <span class="n">pmc_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;pmc_id&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exists</span> <span class="n">pmc_id</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">pmc_jsons</span> <span class="n">subfolders</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pmc_id</span> <span class="n">file</span>
        <span class="k">return</span> <span class="n">pdf</span> <span class="n">file</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_id_paths_dicts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cord19_dataset_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DEPRECATED.</span>
<span class="sd">    This function builds the dictionaries whose keys are identifiers</span>
<span class="sd">    of some kind of papers (PDF or PMC) and whose values are the paths to</span>
<span class="sd">    associated files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">folders</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">):</span>
        <span class="n">num_folders</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">folders</span><span class="p">)</span>
        <span class="n">num_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">root</span> <span class="ow">and</span> <span class="n">num_folders</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num_files</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">all_files</span><span class="p">[</span><span class="n">_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_files</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_id_paths_dicts" class="doc_header"><code>get_id_paths_dicts</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_id_paths_dicts</code>(<strong><code>cord19_dataset_folder</code></strong>)</p>
</blockquote>
<p>DEPRECATED.
This function builds the dictionaries whose keys are identifiers
of some kind of papers (PDF or PMC) and whose values are the paths to
associated files.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pdf_dict</span> <span class="o">=</span> <span class="n">get_id_paths_dicts</span><span class="p">(</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">cord19_dataset_folder</span><span class="p">)</span>
<span class="n">pmc_dict</span> <span class="o">=</span> <span class="n">get_id_paths_dicts</span><span class="p">(</span><span class="s2">&quot;pmc&quot;</span><span class="p">,</span> <span class="n">cord19_dataset_folder</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of PDF files with parse JSON </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pdf_dict</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of PMC files with parse JSON </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pmc_dict</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-PDF-and-PMC-papers">Loading PDF and PMC papers<a class="anchor-link" href="#Loading-PDF-and-PMC-papers"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">BasePaper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata_row</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span> <span class="o">=</span> <span class="n">metadata_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_json_contents</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_referenced_by</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_references</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Avoid RecursionErrors by not pickling references.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_referenced_by&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_references&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">state</span>
    
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_referenced_by</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_references</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_load_json_contents</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contents</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">authors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;authors&quot;</span><span class="p">]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publish_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;publish_time&quot;</span><span class="p">]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bib_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_contents</span><span class="p">[</span><span class="s2">&quot;bib_entries&quot;</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">doi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;doi&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_row</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">register_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>
        <span class="n">reference</span><span class="o">.</span><span class="n">register_referenced</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">register_referenced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">referenced</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_referenced_by</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">referenced</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BasePaper" class="doc_header"><code>class</code> <code>BasePaper</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L48" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BasePaper</code>(<strong><code>metadata_row</code></strong>, <strong><code>file_path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PDFPaper</span><span class="p">(</span><span class="n">BasePaper</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PDFPaper" class="doc_header"><code>class</code> <code>PDFPaper</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L113" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PDFPaper</code>(<strong><code>metadata_row</code></strong>, <strong><code>file_path</code></strong>) :: <a href="/risotto/references#BasePaper"><code>BasePaper</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">PMCPaper</span><span class="p">(</span><span class="n">BasePaper</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PMCPaper" class="doc_header"><code>class</code> <code>PMCPaper</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L117" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PMCPaper</code>(<strong><code>metadata_row</code></strong>, <strong><code>file_path</code></strong>) :: <a href="/risotto/references#BasePaper"><code>BasePaper</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_papers_from_metadata_file</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">):</span>
    <span class="s1">&#39;Loads papers by reading the `metadata.csv` file present in the dataset.&#39;</span>
    <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cord19_dataset_folder</span><span class="si">}</span><span class="s2">/metadata.csv&quot;</span><span class="p">,</span>
                              <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;cord_uid&quot;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pdf_dict = get_id_paths_dicts(&quot;pdf&quot;, cord19_dataset_folder)</span>
<span class="sd">    pmc_dict = get_id_paths_dicts(&quot;pmc&quot;, cord19_dataset_folder)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">papers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># not_found = []</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">progress_bar</span><span class="p">(</span><span class="n">metadata_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span>
                                 <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">)):</span>
        
        <span class="n">paper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pmc_rel_path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;pmc_json_files&quot;</span><span class="p">]</span>
        <span class="n">pdf_rel_path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;pdf_json_files&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">pmc_rel_path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">,</span> <span class="n">pmc_rel_path</span><span class="p">)</span>
            <span class="n">paper</span> <span class="o">=</span> <span class="n">PMCPaper</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">pdf_rel_path</span><span class="p">):</span>
            <span class="n">path_splitted</span> <span class="o">=</span> <span class="n">pdf_rel_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">,</span> <span class="n">path_splitted</span><span class="p">)</span>
            <span class="n">paper</span> <span class="o">=</span> <span class="n">PDFPaper</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">paper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">papers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">papers</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_papers_from_metadata_file" class="doc_header"><code>load_papers_from_metadata_file</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_papers_from_metadata_file</code>(<strong><code>cord19_dataset_folder</code></strong>)</p>
</blockquote>
<p>Loads papers by reading the <code>metadata.csv</code> file present in the dataset.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers</span> <span class="o">=</span> <span class="n">load_papers_from_metadata_file</span><span class="p">(</span><span class="n">cord19_dataset_folder</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">papers</span><span class="p">)</span><span class="si">}</span><span class="s1"> papers found&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mask_1</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s2">&quot;pmc_json_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<span class="n">mask_2</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s2">&quot;pdf_json_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="p">(</span><span class="n">mask_1</span> <span class="o">|</span> <span class="n">mask_2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1"> files with either parsed PDF or PMC XML.&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Peeking-at-the-paper-info-we-just-loaded">Peeking at the paper info we just loaded<a class="anchor-link" href="#Peeking-at-the-paper-info-we-just-loaded"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">paper_as_markdown</span><span class="p">(</span><span class="n">paper</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Markdown</span>
    <span class="n">res</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">- **Title:** </span><span class="si">{</span><span class="n">paper</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"></span>
<span class="s2">- **Authors:** </span><span class="si">{</span><span class="n">paper</span><span class="o">.</span><span class="n">authors</span><span class="si">}</span><span class="s2"></span>
<span class="s2">- **Publish date/time:** </span><span class="si">{</span><span class="n">paper</span><span class="o">.</span><span class="n">publish_time</span><span class="si">}</span><span class="s2"></span>
<span class="s2">- **Linked references:** </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_references</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">- **Linked referenced by:** </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_referenced_by</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">- **Abstract:** </span><span class="si">{</span><span class="n">paper</span><span class="o">.</span><span class="n">abstract</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="paper_as_markdown" class="doc_header"><code>paper_as_markdown</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L154" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>paper_as_markdown</code>(<strong><code>paper</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paper</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">papers</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">paper_as_markdown</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Matching-references-to-titles">Matching references to titles<a class="anchor-link" href="#Matching-references-to-titles"> </a></h2><p>We now make the match between the titles (in plain text) of the references of each paper and their titles.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A dictionary to map titles to papers.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">process_references</span><span class="p">(</span><span class="n">papers</span><span class="p">):</span>
    <span class="n">paper_titles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">progress_bar</span><span class="p">(</span><span class="n">papers</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">paper</span><span class="o">.</span><span class="n">title</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># coping with NaNs in titles</span>
            <span class="n">paper_titles</span><span class="p">[</span><span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">paper</span>

    <span class="n">num_processed_refs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_succesfully_processed_refs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">progress_bar</span><span class="p">(</span><span class="n">papers</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">paper</span><span class="o">.</span><span class="n">bib_entries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ref_title</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ref_title</span> <span class="ow">in</span> <span class="n">paper_titles</span><span class="p">:</span>
                <span class="n">paper</span><span class="o">.</span><span class="n">register_reference</span><span class="p">(</span><span class="n">paper_titles</span><span class="p">[</span><span class="n">ref_title</span><span class="p">])</span>
                <span class="n">num_succesfully_processed_refs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">num_processed_refs</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">bib_entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">num_processed_refs</span><span class="p">,</span> <span class="n">num_succesfully_processed_refs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_references" class="doc_header"><code>process_references</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_references</code>(<strong><code>papers</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_processed_refs</span><span class="p">,</span> <span class="n">num_succesfully_processed_refs</span> <span class="o">=</span> <span class="n">process_references</span><span class="p">(</span><span class="n">papers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total references: </span><span class="si">{</span><span class="n">num_processed_refs</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;References present in the dataset </span><span class="si">{</span><span class="n">num_succesfully_processed_refs</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">num_succesfully_processed_refs</span><span class="o">/</span><span class="n">num_processed_refs</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">%).&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One strategy to mitigate that less than 7% of references are also in the dataset is to create special nodes for the papers outside the set, in this way the structure of the graph is better preserved.</p>
<p>On the other hand, other questions must be answered:</p>
<ul>
<li>How many papers are referenced at least once in the data set?</li>
<li>What are the most referenced papers in the dataset? Long tail?</li>
<li>What are the most referenced papers outside the dataset? Long tail?</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_references</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_referenced_by</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">papers</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_references</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_references</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_referenced_by</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_referenced_by</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Questions:</p>
<ul>
<li>How many papers have at least one referece correctly linked?</li>
<li>How many papers have been references at least once?</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total papers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">papersld</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of references </span><span class="si">{</span><span class="n">num_references</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">num_references</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">papers</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">%).&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of referenced-by </span><span class="si">{</span><span class="n">num_referenced_by</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">num_referenced_by</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">papers</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">%).&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What are the most reference papers?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">papers_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">papers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">_referenced_by</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Most cited paper:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paper_as_markdown</span><span class="p">(</span><span class="n">papers_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>... and its refereces.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">papers_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_references</span><span class="p">:</span>
     <span class="n">paper_as_markdown</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plot-time!">Plot time!<a class="anchor-link" href="#Plot-time!"> </a></h2><p>Note that the dataset includes papers published before the current pandemic started.
The following cells will plot the number of references distribution.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_references</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_references</span><span class="p">)</span> <span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">papers</span><span class="p">],</span>
                        <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">num_referenced_by</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">paper</span><span class="o">.</span><span class="n">_referenced_by</span><span class="p">)</span> <span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="n">papers</span><span class="p">],</span>
                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">num_references</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">papers</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Correctly linked paper references&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">num_referenced_by</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">papers</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;References to papers correclty linked&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>From the plot it's concluded that the number of linked references follow a power law, with a tiny bit of them accounting for most of the references.</p>
<h1 id="PageRank">PageRank<a class="anchor-link" href="#PageRank"> </a></h1><p>The following cells will compute the PageRank score based on the previously built paper references link.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_papers_reference_graph" class="doc_header"><code>build_papers_reference_graph</code><a href="https://github.com/lmarti/risotto/tree/master/risotto/references.py#L185" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_papers_reference_graph</code>(<strong><code>papers</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">build_papers_reference_graph</span><span class="p">(</span><span class="n">papers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sorted_pr</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Top-ranked papers in the graph</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">paper</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_pr</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]:</span>
     <span class="n">paper_as_markdown</span><span class="p">(</span><span class="n">paper</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here it can be seen that the papers with the highest PageRank are highly cited and in general are works from past decades that probably constitute the basis of current research against COVID-19.</p>
<p>The distribution of PageRank scores will be shown below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pr_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_pr</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="c1"># Removing outliers</span>
<span class="n">pr_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pr_values</span><span class="p">)</span>
<span class="n">pr_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pr_values</span><span class="p">)</span>
<span class="n">pr_distance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pr_values</span> <span class="o">-</span> <span class="n">pr_mean</span><span class="p">)</span>
<span class="n">max_std</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">pr_not_outlier</span> <span class="o">=</span> <span class="n">pr_distance</span> <span class="o">&lt;</span> <span class="n">max_std</span> <span class="o">*</span> <span class="n">pr_std</span>
<span class="n">pr_no_outliers</span> <span class="o">=</span> <span class="n">pr_values</span><span class="p">[</span><span class="n">pr_not_outlier</span><span class="p">]</span>

<span class="nb">len</span><span class="p">(</span><span class="n">pr_values</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pr_no_outliers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pr_values</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pr_no_outliers</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">pr_values</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of PageRank of papers including outliers&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">pr_no_outliers</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of PageRank of papers including outliers&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

